<app-navbar></app-navbar>

<div class="mis-resenas-container">
  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <div class="header-section">
      <h1>ğŸ“ Mis ReseÃ±as</h1>
      <p class="subtitle">Gestiona todas tus reseÃ±as de pelÃ­culas</p>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading">
      <p>â³ Cargando tus reseÃ±as...</p>
    </div>

    <!-- EstadÃ­sticas y Filtros -->
    <div *ngIf="!loading" class="stats-and-filters">
      <!-- EstadÃ­sticas -->
      <div class="estadisticas-card">
        <h3>ğŸ“Š Tus EstadÃ­sticas</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number">{{ totalResenas }}</span>
            <span class="stat-label">ReseÃ±as totales</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ promedioCalificacion.toFixed(1) }}</span>
            <span class="stat-label">Promedio general</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getEstrellas(mejorCalificacion) }}</span>
            <span class="stat-label">Mejor calificaciÃ³n</span>
          </div>
        </div>
      </div>

      <!-- Filtros -->
      <div class="filtros-card">
        <h3>ğŸ” Filtrar ReseÃ±as</h3>
        <div class="filtros-grid">
          <div class="filtro-group">
            <label>Por calificaciÃ³n:</label>
            <select [(ngModel)]="filtroCalificacion" (change)="aplicarFiltros()" class="filtro-select">
              <option value="">Todas las calificaciones</option>
              <option value="5">â­â­â­â­â­ - Excelente</option>
              <option value="4">â­â­â­â­â˜† - Bueno</option>
              <option value="3">â­â­â­â˜†â˜† - Regular</option>
              <option value="2">â­â­â˜†â˜†â˜† - Malo</option>
              <option value="1">â­â˜†â˜†â˜†â˜† - Terrible</option>
            </select>
          </div>
          
          <div class="filtro-group">
            <label>Por pelÃ­cula:</label>
            <select 
              [(ngModel)]="filtroPelicula" 
              (change)="aplicarFiltros()"
              class="filtro-select">
              <option value="">Todas las pelÃ­culas</option>
              <option *ngFor="let pelicula of todasLasPeliculas" [value]="pelicula.id">
                {{ pelicula.titulo }}
              </option>
            </select>
          </div>
          
          <button (click)="limpiarFiltros()" class="btn-limpiar">
            ğŸ—‘ï¸ Limpiar
          </button>
        </div>
      </div>
    </div>

    <!-- Lista de ReseÃ±as -->
    <div *ngIf="!loading" class="resenas-section">
      <!-- Mensaje si no hay reseÃ±as -->
      <div *ngIf="misResenas.length === 0" class="no-resenas">
        <h3>ğŸ˜” No tienes reseÃ±as aÃºn</h3>
        <p>Â¡Comienza a escribir reseÃ±as de tus pelÃ­culas favoritas!</p>
        <button (click)="navigateTo('/peliculas')" class="btn-primary">
          ğŸ¬ Ver PelÃ­culas
        </button>
      </div>

      <!-- Mensaje si no hay resultados filtrados -->
      <div *ngIf="misResenas.length > 0 && resenasFiltradas.length === 0" class="no-resultados">
        <h3>ğŸ” No se encontraron reseÃ±as</h3>
        <p>Intenta cambiar los filtros de bÃºsqueda</p>
        <button (click)="limpiarFiltros()" class="btn-secondary">
          ğŸ—‘ï¸ Limpiar Filtros
        </button>
      </div>

      <!-- Grid de reseÃ±as -->
      <div *ngIf="resenasFiltradas.length > 0" class="resenas-grid">
        <div *ngFor="let resena of resenasFiltradas" class="resena-card">
          <!-- Modo normal -->
          <div *ngIf="editandoResena?.id !== resena.id" class="resena-content">
            <div class="resena-header">
              <div class="pelicula-info">
                <h4 class="pelicula-titulo">{{ resena.pelicula?.titulo }}</h4>
                <p class="pelicula-detalles">
                  ğŸ¬ {{ resena.pelicula?.director }} â€¢ ğŸ­ {{ resena.pelicula?.genero }}
                </p>
              </div>
              <div class="resena-rating">
                {{ getEstrellas(resena.calificacion) }}
              </div>
            </div>

            <div class="resena-texto">
              <p>{{ resena.resena }}</p>
            </div>

            <div class="resena-footer">
              <span class="resena-fecha">
                ğŸ“… {{ resena.created_at | date:'dd/MM/yyyy HH:mm' }}
              </span>
              <div class="resena-acciones">
                <button (click)="verPelicula(resena.pelicula?.id)" class="btn-ver">
                  ğŸ‘ï¸ Ver PelÃ­cula
                </button>
                <button (click)="iniciarEdicion(resena)" class="btn-editar">
                  âœï¸ Editar
                </button>
                <button (click)="eliminarResena(resena)" class="btn-eliminar">
                  ğŸ—‘ï¸ Eliminar
                </button>
              </div>
            </div>
          </div>

          <!-- Modo ediciÃ³n -->
          <div *ngIf="editandoResena?.id === resena.id" class="resena-edit">
            <div class="edit-header">
              <h4>âœï¸ Editando reseÃ±a de "{{ resena.pelicula?.titulo }}"</h4>
            </div>

            <div class="edit-form">
              <div class="form-group">
                <label>Nueva calificaciÃ³n:</label>
                <select [(ngModel)]="resenaEditada.calificacion" class="form-select">
                  <option value="1">1â­ - Terrible</option>
                  <option value="2">2â­ - Malo</option>
                  <option value="3">3â­ - Regular</option>
                  <option value="4">4â­ - Bueno</option>
                  <option value="5">5â­ - Excelente</option>
                </select>
              </div>

              <div class="form-group">
                <label>Nueva reseÃ±a:</label>
                <textarea 
                  [(ngModel)]="resenaEditada.resena" 
                  placeholder="Actualiza tu opiniÃ³n sobre la pelÃ­cula..."
                  class="form-textarea"
                  rows="4">
                </textarea>
              </div>

              <div class="edit-actions">
                <button (click)="guardarEdicion()" class="btn-primary">
                  ğŸ’¾ Guardar Cambios
                </button>
                <button (click)="cancelarEdicion()" class="btn-secondary">
                  âŒ Cancelar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- BotÃ³n flotante para agregar reseÃ±a -->
    <button (click)="navigateTo('/peliculas')" class="btn-flotante" title="Escribir nueva reseÃ±a">
      â• Nueva ReseÃ±a
    </button>
  </main>
</div>
